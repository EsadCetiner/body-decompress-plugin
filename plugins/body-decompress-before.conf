# This rule checks if RESPONSE_BODY is compressed using gzip:
# - Content-Encoding header must contain any of gzip, compress, deflate
# - RESPONSE_BODY must begin with gzip magic number
SecRule TX:BODY-DECOMPRESS-PLUGIN_ENABLE "@eq 1" \
    "id:9503120,\
    phase:4,\
    pass,\
    nolog,\
    ver:'body-decompress-plugin/1.0.0',\
    chain"
    SecRule RESPONSE_HEADERS:Content-Encoding "@pm gzip compress deflate" \
        "chain"
        SecRule RESPONSE_BODY "@rx ^\x1f\x8b" \
            "t:none,\
            chain"
            SecRuleScript body-decompress.lua
